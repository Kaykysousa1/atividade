<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Batalha Naval</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: #eef;
    }

    h1 {
      margin-top: 20px;
    }

    .boards {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin: 20px 0;
    }

    .board {
      display: grid;
      grid-template-columns: repeat(5, 30px);
      grid-template-rows: repeat(5, 30px);
      gap: 2px;
      padding: 5px;
    }

    .cell {
      width: 30px;
      height: 30px;
      background-color: rgb(102, 117, 247);
      cursor: pointer;
    }

    .cell.ship {
      background-color: #555;
    }

    .cell.hit {
      background-color: red;
    }

    .cell.miss {
      background-color: white;
    }

    #controls {
      margin: 20px 0;
    }

    #message {
      font-weight: bold;
      margin-top: 10px;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
    }
  </style>
</head>
<body>

  <h1>Batalha Naval</h1>

  <div class="boards">
    <div>
      <h2>Seu Tabuleiro</h2>
      <div id="player-board" class="board"></div>
    </div>
    <div>
      <h2>Tabuleiro do Inimigo</h2>
      <div id="cpu-board" class="board"></div>
    </div>
  </div>

  <div id="controls">
    <p>Tentativas restantes: <span id="player-turns"></span></p>
    <button id="restart">🔄 Reiniciar Jogo</button>
    <p id="message"></p>
  </div>

  <script>
    // --- Configurações do Jogo ---
    const TAMANHO_TABULEIRO = 5;
    const TAMANHO_NAVIO = 1;
    const MAX_TENTATIVAS = 10;

    // --- Elementos do DOM ---
    const cpuBoardElement = document.getElementById('cpu-board');
    const playerBoardElement = document.getElementById('player-board');
    const turnsElement = document.getElementById('player-turns');
    const messageElement = document.getElementById('message');
    const restartButton = document.getElementById('restart');

    // --- Variáveis de Estado do Jogo ---
    let cpuBoard = [];
    let playerBoard = [];
    let playerTurns = MAX_TENTATIVAS;
    let navioRestante = TAMANHO_NAVIO;
    let cpuNavioRestante = TAMANHO_NAVIO;
    let gameIsOver = false;

    function criarTabuleiro() {
      const tabuleiro = [];
      for (let i = 0; i < TAMANHO_TABULEIRO; i++) {
        tabuleiro.push(Array(TAMANHO_TABULEIRO).fill(0));
      }
      return tabuleiro;
    }

    function posicionarNavio(tabuleiro, tamanhoNavio) {
      let colocado = false;
      while (!colocado) {
        const orientacao = Math.random() < 0.5 ? 'horizontal' : 'vertical';
        let linha = Math.floor(Math.random() * TAMANHO_TABULEIRO);
        let coluna = Math.floor(Math.random() * TAMANHO_TABULEIRO);

        if (orientacao === 'horizontal' && coluna + tamanhoNavio <= TAMANHO_TABULEIRO) {
          let podeColocar = true;
          for (let i = 0; i < tamanhoNavio; i++) {
            if (tabuleiro[linha][coluna + i] !== 0) {
              podeColocar = false;
              break;
            }
          }
          if (podeColocar) {
            for (let i = 0; i < tamanhoNavio; i++) {
              tabuleiro[linha][coluna + i] = 1;
            }
            colocado = true;
          }
        } else if (orientacao === 'vertical' && linha + tamanhoNavio <= TAMANHO_TABULEIRO) {
          let podeColocar = true;
          for (let i = 0; i < tamanhoNavio; i++) {
            if (tabuleiro[linha + i][coluna] !== 0) {
              podeColocar = false;
              break;
            }
          }
          if (podeColocar) {
            for (let i = 0; i < tamanhoNavio; i++) {
              tabuleiro[linha + i][coluna] = 1;
            }
            colocado = true;
          }
        }
      }
    }

    function renderizarTabuleiro(elementoTabuleiro, tabuleiro, revelarNavios) {
      elementoTabuleiro.innerHTML = '';
      for (let i = 0; i < TAMANHO_TABULEIRO; i++) {
        for (let j = 0; j < TAMANHO_TABULEIRO; j++) {
          const cell = document.createElement('div');
          cell.classList.add('cell');
          cell.dataset.linha = i;
          cell.dataset.coluna = j;
          if (revelarNavios && tabuleiro[i][j] === 1) {
            cell.classList.add('ship');
          } else if (tabuleiro[i][j] === 2) {
            cell.classList.add('hit');
          } else if (tabuleiro[i][j] === 3) {
            cell.classList.add('miss');
          }
          elementoTabuleiro.appendChild(cell);
        }
      }
    }

    function handlePlayerShot(event) {
      if (gameIsOver) return;

      const cell = event.target;
      if (!cell.classList.contains('cell')) return;

      const linha = parseInt(cell.dataset.linha);
      const coluna = parseInt(cell.dataset.coluna);

      if (cpuBoard[linha][coluna] === 2 || cpuBoard[linha][coluna] === 3) {
        messageElement.textContent = "Você já atacou essa posição antes!";
        return;
      }

      playerTurns--;
      turnsElement.textContent = playerTurns;

      if (cpuBoard[linha][coluna] === 1) {
        messageElement.textContent = "Acertou! Continue assim!";
        cpuBoard[linha][coluna] = 2;
        navioRestante--;
        cell.classList.add('hit');
        if (navioRestante === 0) {
          messageElement.textContent = "VOCÊ AFUNDOU O NAVIO! VITÓRIA!";
          gameIsOver = true;
          renderizarTabuleiro(cpuBoardElement, cpuBoard, true);
          return;
        }
      } else {
        messageElement.textContent = "Água... você errou!";
        cpuBoard[linha][coluna] = 3;
        cell.classList.add('miss');
      }

      if (playerTurns <= 0 && navioRestante > 0) {
        messageElement.textContent = "Suas tentativas acabaram. Fim de jogo!";
        gameIsOver = true;
        renderizarTabuleiro(cpuBoardElement, cpuBoard, true);
        return;
      }

      // Se o jogo ainda não acabou, a CPU joga
      if (!gameIsOver) {
        setTimeout(ataqueDaMaquina, 1000);
      }
    }

    function ataqueDaMaquina() {
      if (gameIsOver) return;

      let linha, coluna;
      do {
        linha = Math.floor(Math.random() * TAMANHO_TABULEIRO);
        coluna = Math.floor(Math.random() * TAMANHO_TABULEIRO);
      } while (playerBoard[linha][coluna] === 2 || playerBoard[linha][coluna] === 3);

      const cellIndex = linha * TAMANHO_TABULEIRO + coluna;
      const cell = playerBoardElement.children[cellIndex];

      if (playerBoard[linha][coluna] === 1) {
        playerBoard[linha][coluna] = 2;
        cell.classList.add('hit');
        messageElement.textContent += " | O inimigo acertou seu navio!";
        cpuNavioRestante--;
        if (cpuNavioRestante === 0) {
          messageElement.textContent = "O inimigo afundou seu navio. DERROTA!";
          gameIsOver = true;
          renderizarTabuleiro(playerBoardElement, playerBoard, true);
        }
      } else {
        playerBoard[linha][coluna] = 3;
        cell.classList.add('miss');
        messageElement.textContent += " | O inimigo errou!";
      }
    }

    function iniciarJogo() {
      gameIsOver = false;
      playerTurns = MAX_TENTATIVAS;
      navioRestante = TAMANHO_NAVIO;
      cpuNavioRestante = TAMANHO_NAVIO;
      turnsElement.textContent = playerTurns;
      messageElement.textContent = "Bom jogo! Tente afundar o navio.";

      cpuBoard = criarTabuleiro();
      playerBoard = criarTabuleiro();

      posicionarNavio(cpuBoard, TAMANHO_NAVIO);
      posicionarNavio(playerBoard, TAMANHO_NAVIO);

      renderizarTabuleiro(cpuBoardElement, cpuBoard, false);
      renderizarTabuleiro(playerBoardElement, playerBoard, true);

      cpuBoardElement.addEventListener('click', handlePlayerShot);
    }

    restartButton.addEventListener('click', iniciarJogo);

    iniciarJogo();
  </script>
</body>
</html>
